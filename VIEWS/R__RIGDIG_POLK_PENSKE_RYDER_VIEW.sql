create or replace view ITD_SCHEMACHANGE_DEMO.RIGDIG_POLK_PENSKE_RYDER_VIEW as
select re.RRID
      ,re.USDOT
      ,re.EDABUYID
      ,re.ENT_COMPANY1
      ,re.ENT_COMPANY2
      ,re.DNB_COMPANY_NAME
      ,re.ENT_CONTACT1_FIRST
      ,re.ENT_CONTACT1_LAST
      ,re.ENT_CONTACT2_FIRST
      ,re.ENT_CONTACT2_LAST
      ,re.ENT_PHONE_OFFICE
      ,re.ENT_PHONE_ALTERNATE
      ,re.ENT_EMAIL_AVAILABLE
      ,re.ENT_EMAIL_COUNT
      ,re.ENT_PHY_ADDRESS
      ,re.ENT_PHY_CITY
      ,re.ENT_PHY_STATE
      ,re.ENT_PHY_ZIP
      ,re.ENT_PHY_COUNTRY
      ,re.ENT_PHY_FIPS
      ,re.ENT_PHY_COUNTY_STATE
      ,re.ENT_PHY_DPV
      ,re.ENT_DOMRA
      ,re.ENT_DOMRA_SOURCE
      ,re.ENT_MCS150_DATE
      ,re.ENT_OP_TYPE_DESC
      ,re.ENT_OP_CLASS_DESC
      ,re.ENT_OP_SEGMENT
      ,re.ENT_OP_AUTH
      ,re.ACT_STATES_OPERATED
      ,re.ACT_LICENSE_STATES
      ,re.DNB_DUNS
      ,re.DNB_DUNS_ULTIMATE_DOM_PARENT
      ,re.DNB_LOCATION_TYPE
      ,re.DNB_FAMILY_MEMBERS
      ,re.DNB_SUBSIDIARY
      ,re.DNB_MAJOR_INDUSTRY_DESC
      ,re.DNB_PRIMARY_SIC
      ,re.DNB_PRIMARY_SIC_DESC
      ,re.DNB_NAICS
      ,re.DNB_EMPL_HERE
      ,re.DNB_EMPL_HERE_CODE
      ,re.DNB_ANNUAL_SALES
      ,re.DNB_ANNUAL_SALES_CODE
      ,re.DNB_YEAR_STARTED
      ,re.DNB_OUT_OF_BUSINESS
      ,re.DNB_RISK_FLAG
      ,re.ENT_CARGO_BEVERAGES
      ,re.ENT_CARGO_GENFREIGHT
      ,re.ENT_CARGO_HOUSEHOLD
      ,re.ENT_CARGO_PAPERPROD
      ,re.ENT_CARGO_USMAIL
      ,re.ENT_CARGO_COLDFOOD
      ,re.ENT_CARGO_MEAT
      ,re.ENT_CARGO_PRODUCE
      ,re.ENT_CARGO_BLDGMAT
      ,re.ENT_CARGO_LOGPOLE
      ,re.ENT_CARGO_MACHLRG
      ,re.ENT_CARGO_METALSHEET
      ,re.ENT_CARGO_OILFIELD
      ,re.ENT_CARGO_CHEM
      ,re.ENT_CARGO_DRYBULK
      ,re.ENT_CARGO_LIQGAS
      ,re.ENT_CARGO_COALCOKE
      ,re.ENT_CARGO_GRAINFEED
      ,re.ENT_CARGO_CONSTRUCT
      ,re.ENT_CARGO_DRIVETOW
      ,re.ENT_CARGO_FARMSUPP
      ,re.ENT_CARGO_GARBAGE
      ,re.ENT_CARGO_NUMBERERMODAL
      ,re.ENT_CARGO_LIVESTOCK
      ,re.ENT_CARGO_MOBILEHOME
      ,re.ENT_CARGO_MOTORVEH
      ,re.ENT_CARGO_PASSENGERS
      ,re.ENT_CARGO_UTILITY
      ,re.ENT_CARGO_WATERWELL
      ,re.ENT_CARGO_OTHER
      ,re.ENT_CARGO_OTHER_DESC
      ,re.ENT_CARGO_HAZMAT
      ,re.ENT_DRVR_LESS_100
      ,re.ENT_DRVR_GREATER_100
      ,re.ENT_DRVR_TOTAL
      ,re.ENT_DRVR_GREATER_100_RATIO
      ,re.ENT_DRVR_GREATER_100_PROPENSITY
      ,re.ENT_DRVR_TOTAL_CDL
      ,re.ENT_UNITS_EST_PWR
      ,re.ENT_UNITS_EST_PWR_RANGE
      ,re.ENT_USDOT_OWN_TRUCK
      ,re.ENT_USDOT_OWN_TRACT
      ,re.ENT_USDOT_OWN_TRK
      ,re.ENT_USDOT_TERM_LEASE_TRUCK
      ,re.ENT_USDOT_TERM_LEASE_TRACT
      ,re.ENT_USDOT_TERM_LEASE_TRK
      ,re.ENT_USDOT_TOTAL_TRUCK
      ,re.ENT_USDOT_TOTAL_TRACT
      ,re.ENT_USDOT_TOTAL_TRK
      ,re.ENT_USDOT_TOTAL_PWR
      ,re.ENT_USDOT_TOTAL_TRAIL
      ,re.ENT_USDOT_TRACT_RATIO
      ,re.ENT_USDOT_LEASE_RATIO
      ,re.ENT_USDOT_LEASE_PROPENSITY
      ,re.ENT_TRAIL_TO_PWR_RATIO
      ,re.ENT_MLG_CALENDAR_YEAR
      ,re.ENT_AVG_MILES_PWR_UNIT
      ,re.EQT_CLASS_3_UNITS
      ,re.EQT_CLASS_4_UNITS
      ,re.EQT_CLASS_5_UNITS
      ,re.EQT_CLASS_6_UNITS
      ,re.EQT_CLASS_7_UNITS
      ,re.EQT_CLASS_8_UNITS
      ,re.EQT_CLASS_3TO8_UNITS
      ,re.EQT_CLASS_ALL_UNITS
      ,re.EQT_CLASS_AVG_OPERATED
      ,re.EQT_PREV_OP_VIN_RATIO
      ,re.EQT_PREV_OP_VIN_PROPENSITY
      ,re.EQT_BRAND_FREIGHTLINER
      ,re.EQT_BRAND_NUMBERL
      ,re.EQT_BRAND_PETERBILT
      ,re.EQT_BRAND_KENWORTH
      ,re.EQT_BRAND_VOLVO
      ,re.EQT_BRAND_FORD
      ,re.EQT_BRAND_MACK
      ,re.EQT_BRAND_CHEVROLET
      ,re.EQT_BRAND_GMC
      ,re.EQT_BRAND_STERLING
      ,re.EQT_BRAND_ISUZU
      ,re.EQT_BRAND_WEST_STAR
      ,re.EQT_BRAND_HINO
      ,re.EQT_BRAND_DODGE
      ,re.EQT_BRAND_MITSUBISHI
      ,re.EQT_ENG_CUMMINS
      ,re.EQT_ENG_CAT
      ,re.EQT_ENG_DETROIT
      ,re.EQT_ENG_NAVISTAR
      ,re.EQT_ENG_MACK
      ,re.EQT_ENG_VOLVO
      ,re.EQT_ENG_MERCEDES
      ,re.EQT_ENG_ISUZU
      ,re.EQT_ENG_HINO
      ,re.EQT_ENG_PACCAR
      ,re.EQT_ENG_GM
      ,re.EQT_ENG_FORD
      ,re.EQT_ENG_UD_NISSAN
      ,re.EQT_MODEL_AVG_AGE
      ,re.EQT_MODEL_AVG_AGE_PROPENSITY
      ,re.UCC_VOCATIONAL_TOTAL
      ,re.UCC_CEMENTMIXER_UNITS
      ,re.UCC_DUMPBODY_UNITS
      ,re.UCC_REFUSEBODY_UNITS
      ,re.UCC_CONSTTRL_UNITS
      ,re.UCC_DUMPTRIL_UNITS
      ,re.UCC_CE_UNITS
      ,re.UCC_AG_UNITS
      ,re.UCC_LG_UNITS
      ,re.UCC_OFFROAD_UNITS
      ,re.UCC_OFFROAD_UNIT_RANGE
      ,re.ENT_SFTY_RATING_DESC
      ,re.ENT_SFTY_RATING_SCORE
      ,re.ENT_SFTY_EFFECTIVE_DATE
      ,re.CSA_UNSAFE_DRIV_BASIC_ALERT_SCORE
      ,re.CSA_FATIGUE_DRIV_BASIC_ALERT_SCORE
      ,re.CSA_DRIV_FIT_BASIC_ALERT_SCORE
      ,re.CSA_CONTR_SUBST_BASIC_SCORE
      ,re.CSA_VEH_MANUMBER_BASIC_ALERT_SCORE
      ,re.CSA_ANY_BASIC_ALERT_SCORE
      ,re.INSP_TOTAL
      ,re.INSP_VIOL_TOTAL
      ,re.INSP_VIOL_RATIO
      ,re.INSP_VIOL_RATIO_GROUP
      ,re.INSP_VIOL_TOTAL_HOURS_OF_SERVICE
      ,re.INSP_VIOL_TOTAL_HOURS_OF_SERVICE_RATIO
      ,re.INSP_VIOL_TOTAL_HOURS_OF_SERVICE_RATIO_RELATIVE_GROUP
      ,re.INSP_VIOL_DRIVER_10_15_HOURS
      ,re.INSP_VIOL_DRIVER_60_70_80_HOURS
      ,re.INSP_VIOL_DRIVER_ALL_OTHER_HOURS_OF_SERVICE
      ,re.INSP_VIOL_DRIVER_FALSE_LOG_BOOK
      ,re.INSP_VIOL_DRIVER_NO_LOG_BOOK_LOG_NOT_CURRENT
      ,re.INSP_VIOL_DRIVER_STATE_LOCAL_HOURS_OF_SERVICE
      ,re.INSP_VIOL_TOTAL_CONTROLLED_SUBSTANCE
      ,re.INSP_VIOL_TOTAL_CONTROLLED_SUBSTANCE_RATIO
      ,re.INSP_VIOL_TOTAL_CONTROLLED_SUBSTANCE_RATIO_RELATIVE_GROUP
      ,re.INSP_VIOL_DRIVER_ALCOHOL
      ,re.INSP_VIOL_DRIVER_DRUGS
      ,re.INSP_VIOL_TOTAL_UNSAFE_DRIVING
      ,re.INSP_VIOL_TOTAL_UNSAFE_DRIVING_RATIO
      ,re.INSP_VIOL_TOTAL_UNSAFE_DRIVING_RATIO_RELATIVE_GROUP
      ,re.INSP_VIOL_DRIVER_FAILURE_TO_OBEY_TRAFFIC_CONTROL_DEVICE
      ,re.INSP_VIOL_DRIVER_FAILURE_TO_YIELD_RIGHT_OF_WAY
      ,re.INSP_VIOL_DRIVER_FOLLOWING_TOO_CLOSE
      ,re.INSP_VIOL_DRIVER_IMPROPER_LANE_CHANGE
      ,re.INSP_VIOL_DRIVER_IMPROPER_PASSING
      ,re.INSP_VIOL_DRIVER_IMPROPER_TURNS
      ,re.INSP_VIOL_DRIVER_RADAR_DETECTORS
      ,re.INSP_VIOL_DRIVER_RECKLESS_DRIVING
      ,re.INSP_VIOL_DRIVER_SEAT_BELT
      ,re.INSP_VIOL_DRIVER_SIZE_AND_WEIGHT
      ,re.INSP_VIOL_DRIVER_SPEEDING
      ,re.INSP_VIOL_DRIVER_TRAFFIC_ENFORCEMENT
      ,re.INSP_VIOL_TOTAL_DRIVER_FITNESS
      ,re.INSP_VIOL_TOTAL_DRIVER_FITNESS_RATIO
      ,re.INSP_VIOL_TOTAL_DRIVER_FITNESS_RATIO_RELATIVE_GROUP
      ,re.INSP_VIOL_DRIVER_MEDICAL_CERTIFICATE
      ,re.INSP_VIOL_DRIVER_DISQUALIFIED_DRIVERS
      ,re.INSP_VIOL_TOTAL_HAZMAT
      ,re.INSP_VIOL_TOTAL_HAZMAT_RATIO
      ,re.INSP_VIOL_TOTAL_HAZMAT_RATIO_RELATIVE_GROUP
      ,re.INSP_VIOL_HAZMAT_ACCEPTING_SHIPMENT_IMPROPERLY_MARKED
      ,re.INSP_VIOL_HAZMAT_ALL_OTHER_HAZMAT_VIOLATIONS
      ,re.INSP_VIOL_HAZMAT_EMERGENCY_RESPONSE
      ,re.INSP_VIOL_HAZMAT_IMPROPER_BLOCKING_AND_BRACING
      ,re.INSP_VIOL_HAZMAT_IMPROPER_PLACARDING
      ,re.INSP_VIOL_HAZMAT_NO_REMOTE_SHUTOFF_CONTROL
      ,re.INSP_VIOL_HAZMAT_NO_RETEST_AND_INSPECTION_CARGO_TANK
      ,re.INSP_VIOL_HAZMAT_SHIPPING_PAPER
      ,re.INSP_VIOL_HAZMAT_USE_OF_NON_SPECIFICATION_CONTAINER
      ,re.INSP_VIOL_TOTAL_VEH_MANUMBER
      ,re.INSP_VIOL_TOTAL_VEH_MANUMBER_RATIO
      ,re.INSP_VIOL_TOTAL_VEH_MANUMBER_RATIO_RELATIVE_GROUP
      ,re.INSP_VIOL_VEHICLE_ALL_OTHER_BRAKE_VIOLATIONS
      ,re.INSP_VIOL_VEHICLE_ALL_OTHER_VEHICLE_DEFECTS
      ,re.INSP_VIOL_VEHICLE_BRAKES_OUT_OF_ADJUSTMENT
      ,re.INSP_VIOL_VEHICLE_COUPLING_DEVICES
      ,re.INSP_VIOL_VEHICLE_EMERGENCY_EQUIPMENT
      ,re.INSP_VIOL_VEHICLE_EXHAUST_DISCHARGE
      ,re.INSP_VIOL_VEHICLE_FRAMES
      ,re.INSP_VIOL_VEHICLE_FUEL_SYSTEMS
      ,re.INSP_VIOL_VEHICLE_LIGHTING
      ,re.INSP_VIOL_VEHICLE_LOAD_SECUREMENT
      ,re.INSP_VIOL_VEHICLE_PERIODIC_INSPECTION
      ,re.INSP_VIOL_VEHICLE_STEERING_MECHANISM
      ,re.INSP_VIOL_VEHICLE_SUSPENSION
      ,re.INSP_VIOL_VEHICLE_TIRES
      ,re.INSP_VIOL_VEHICLE_WHEELS_STUDS_CLAMPS
      ,re.INSP_VIOL_VEHICLE_WINDSHIELD
      ,re.INSP_VIOL_TOTAL_OTHER
      ,re.INSP_VIOL_TOTAL_OTHER_RATIO
      ,re.INSP_VIOL_DRIVER_ALL_OTHER_DRIVER_VIOLATIONS
      ,re.INSP_VIOL_UNKNOWN
      ,re.ACC_TOTAL_COUNT
      ,re.ACC_TO_PWR_EST_RATIO
      ,re.ACC_RATIO_GROUP
      ,re.ACC_FATALITY_COUNT
      ,re.ACC_FATALITY_TOTAL
      ,re.ACC_INJURY_COUNT
      ,re.ACC_INJURY_TOTAL
      ,re.ACC_PROPERTY_COUNT
      ,re.ACC_TOWAWAY_COUNT
      ,re.ACC_ROLLOVER_COUNT
      ,re.ENT_STATUS
      ,re.SEGMENT_CONCRETE_MIXER
      ,re.SEGMENT_DUMP
      ,re.SEGMENT_HEAVY_HAUL
      ,re.SEGMENT_REFUSE
      ,rl.EQT_VIN_SN
      ,rl.EQT_MAKE
      ,rl.EQT_MODEL_YEAR
      ,rl.EQT_GVWR_CLASS
      ,rl.EQT_DOMRA_ENT
      ,rl.EQT_DOMRA_VIN
      ,rl.EQT_OUT_OF_FLEET_FLAG
      ,pn.*
      ,case when upper(pn.REG_NAME) like '%PENSKE%' then 1 else 0 end as PENSKE
      ,case when upper(pn.REG_NAME) like '%RYDER%' then 1 else 0 end as RYDER
      ,case when upper(pn.REG_NAME) like '%IDEALEASE%' then 1 else 0 end as IDEALEASE
      ,case when upper(pn.REG_NAME) like '%NATIONALEASE%' then 1 else 0 end as NATIONALEASE
      ,case when upper(pn.REG_NAME) like '%PACLEASE%' then 1 else 0 end as PACLEASE
from ITD_SCHEMACHANGE_DEMO.RIGDIG_ENTITY_ALL re
inner join ITD_SCHEMACHANGE_DEMO.RIGDIG_LINEAGE_ALL rl
on re.RRID = rl.RRID
inner join ITD_SCHEMACHANGE_DEMO.POLK_NEWTRK_ALL pn
on rl.EQT_VIN_SN = pn.VIN
where pn.VIN_GVW in ('6','7','8')
and pn.REG_VOCATION like '%LEASE%'
and (upper(pn.REG_NAME) like '%PENSKE%' or upper(pn.REG_NAME) like '%RYDER%'
  or upper(pn.REG_NAME) like '%IDEALEASE%' or upper(pn.REG_NAME) like '%NATIONALEASE%')
;
